<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡ç®¡ç†ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background: #00bfa5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .test-button:hover {
            background: #00a693;
        }
        .scene-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            min-width: 120px;
        }
        .scene-button:hover {
            background: #2563eb;
        }
        .scene-button.active {
            background: #10b981;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #00bfa5;
        }
        .device-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #e8f5e8;
            border-radius: 4px;
            border-left: 3px solid #4caf50;
        }
        .device-name {
            font-weight: bold;
            color: #333;
        }
        .device-state {
            font-size: 14px;
            color: #666;
        }
        .floating-ball {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: #00bfa5;
            box-shadow: 0 4px 12px rgba(0, 191, 165, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .floating-ball:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 191, 165, 0.4);
        }
        .floating-ball.listening {
            background: #ff5722;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ  è®¾å¤‡ç®¡ç†ä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•è¯­éŸ³è¯†åˆ«æŒ‰é’®å’Œåœºæ™¯æ¨¡å¼çš„è“ç‰™ä¿¡å·å‘é€åŠŸèƒ½</p>

        <div class="test-section">
            <h3>ğŸ¤ è¯­éŸ³è¯†åˆ«æµ‹è¯•</h3>
            <p>æµ‹è¯•æ‚¬æµ®çƒè¯­éŸ³è¯†åˆ«åŠŸèƒ½ï¼ˆæ¨¡æ‹Ÿï¼‰</p>
            <button class="test-button" onclick="testVoiceRecognition()">æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«</button>
            <div id="voiceResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸŒŸ åœºæ™¯æ¨¡å¼æµ‹è¯•</h3>
            <p>æµ‹è¯•åœºæ™¯æ¿€æ´»æ—¶çš„è“ç‰™ä¿¡å·å‘é€</p>
            <div class="scene-buttons">
                <button class="scene-button" onclick="testScene('morning')">æ—©æ™¨æ¨¡å¼</button>
                <button class="scene-button" onclick="testScene('sleep')">ç¡çœ æ¨¡å¼</button>
                <button class="scene-button" onclick="testScene('movie')">å½±é™¢æ¨¡å¼</button>
                <button class="scene-button" onclick="testScene('guest')">ä¼šå®¢æ¨¡å¼</button>
            </div>
            <div id="sceneResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š è®¾å¤‡çŠ¶æ€æ¨¡æ‹Ÿ</h3>
            <div id="deviceStatus">
                <div class="device-status">
                    <div class="device-name">å®¢å…ç¯</div>
                    <div class="device-state" id="device-1">å…³é—­</div>
                </div>
                <div class="device-status">
                    <div class="device-name">å§å®¤ä¸»ç¯</div>
                    <div class="device-state" id="device-2">å…³é—­</div>
                </div>
                <div class="device-status">
                    <div class="device-name">å§å®¤æ°›å›´ç¯</div>
                    <div class="device-state" id="device-3">å…³é—­</div>
                </div>
                <div class="device-status">
                    <div class="device-name">ç©ºè°ƒ</div>
                    <div class="device-state" id="device-4">å…³é—­</div>
                </div>
                <div class="device-status">
                    <div class="device-name">éŸ³å“</div>
                    <div class="device-state" id="device-7">å…³é—­</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿæ‚¬æµ®çƒ -->
    <div class="floating-ball" id="floatingBall" onclick="toggleVoiceRecognition()">
        ğŸ¤
    </div>

    <script>
        // æ¨¡æ‹Ÿè®¾å¤‡çŠ¶æ€
        const deviceStates = {
            1: false, // å®¢å…ç¯
            2: false, // å§å®¤ä¸»ç¯
            3: false, // å§å®¤æ°›å›´ç¯
            4: false, // ç©ºè°ƒ
            7: false  // éŸ³å“
        };

        // åœºæ™¯é…ç½®
        const scenes = {
            morning: {
                name: 'æ—©æ™¨æ¨¡å¼',
                devices: [
                    { id: 1, active: true },  // å®¢å…ç¯
                    { id: 2, active: true },  // å§å®¤ä¸»ç¯
                    { id: 4, active: true },  // ç©ºè°ƒ
                    { id: 7, active: true }   // éŸ³å“
                ]
            },
            sleep: {
                name: 'ç¡çœ æ¨¡å¼',
                devices: [
                    { id: 1, active: false }, // å®¢å…ç¯
                    { id: 2, active: false }, // å§å®¤ä¸»ç¯
                    { id: 3, active: true },  // å§å®¤æ°›å›´ç¯
                    { id: 4, active: false }, // ç©ºè°ƒ
                    { id: 7, active: false }  // éŸ³å“
                ]
            },
            movie: {
                name: 'å½±é™¢æ¨¡å¼',
                devices: [
                    { id: 1, active: true },  // å®¢å…ç¯
                    { id: 7, active: true }   // éŸ³å“
                ]
            },
            guest: {
                name: 'ä¼šå®¢æ¨¡å¼',
                devices: [
                    { id: 1, active: true },  // å®¢å…ç¯
                    { id: 4, active: true },  // ç©ºè°ƒ
                    { id: 7, active: true }   // éŸ³å“
                ]
            }
        };

        let isListening = false;

        // æ›´æ–°è®¾å¤‡çŠ¶æ€æ˜¾ç¤º
        function updateDeviceDisplay() {
            Object.keys(deviceStates).forEach(id => {
                const element = document.getElementById(`device-${id}`);
                if (element) {
                    element.textContent = deviceStates[id] ? 'å¼€å¯' : 'å…³é—­';
                    element.style.color = deviceStates[id] ? '#10b981' : '#6b7280';
                }
            });
        }

        // æ¨¡æ‹Ÿè“ç‰™ä¿¡å·å‘é€
        function sendBluetoothSignal(signal, deviceName) {
            console.log(`[è“ç‰™ä¿¡å·] å‘é€ä¿¡å·: ${signal} - ${deviceName}`);
            return new Promise(resolve => {
                setTimeout(() => {
                    console.log(`[è“ç‰™ä¿¡å·] ä¿¡å·å‘é€æˆåŠŸ: ${signal}`);
                    resolve(true);
                }, 100);
            });
        }

        // æµ‹è¯•è¯­éŸ³è¯†åˆ«
        async function testVoiceRecognition() {
            const testCommands = [
                'æ‰“å¼€å®¢å…çš„ç¯',
                'å…³é—­ç©ºè°ƒ',
                'æ‰“å¼€éŸ³å“',
                'å…³é—­æ‰€æœ‰ç¯'
            ];
            
            const randomCommand = testCommands[Math.floor(Math.random() * testCommands.length)];
            
            document.getElementById('voiceResult').innerHTML = `
                <div class="result">
                    <strong>æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«:</strong> "${randomCommand}"<br>
                    <strong>å¤„ç†ç»“æœ:</strong> å·²å‘é€å¯¹åº”è“ç‰™ä¿¡å·<br>
                    <strong>æ—¶é—´:</strong> ${new Date().toLocaleTimeString()}
                </div>
            `;

            // æ¨¡æ‹Ÿè®¾å¤‡æ§åˆ¶
            if (randomCommand.includes('å®¢å…') && randomCommand.includes('ç¯')) {
                deviceStates[1] = randomCommand.includes('æ‰“å¼€');
                await sendBluetoothSignal('1', 'å®¢å…ç¯');
            } else if (randomCommand.includes('ç©ºè°ƒ')) {
                deviceStates[4] = randomCommand.includes('æ‰“å¼€');
                await sendBluetoothSignal('9', 'ç©ºè°ƒ');
            } else if (randomCommand.includes('éŸ³å“')) {
                deviceStates[7] = randomCommand.includes('æ‰“å¼€');
                await sendBluetoothSignal('b', 'éŸ³å“');
            }

            updateDeviceDisplay();
        }

        // æµ‹è¯•åœºæ™¯æ¨¡å¼
        async function testScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;

            // é‡ç½®æ‰€æœ‰æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.scene-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ¿€æ´»å½“å‰æŒ‰é’®
            event.target.classList.add('active');

            console.log(`[åœºæ™¯æ§åˆ¶] æ¿€æ´»åœºæ™¯: ${scene.name}`);

            let resultHtml = `
                <div class="result">
                    <strong>æ¿€æ´»åœºæ™¯:</strong> ${scene.name}<br>
                    <strong>æ§åˆ¶è®¾å¤‡:</strong><br>
            `;

            // æ‰§è¡Œåœºæ™¯ä¸­çš„è®¾å¤‡æ§åˆ¶
            for (const device of scene.devices) {
                const deviceName = getDeviceName(device.id);
                const action = device.active ? 'å¼€å¯' : 'å…³é—­';
                const signal = getDeviceSignal(device.id, device.active);
                
                console.log(`[åœºæ™¯æ§åˆ¶] ${deviceName} -> ${action}`);
                
                // å‘é€è“ç‰™ä¿¡å·
                await sendBluetoothSignal(signal, deviceName);
                
                // æ›´æ–°è®¾å¤‡çŠ¶æ€
                deviceStates[device.id] = device.active;
                
                resultHtml += `&nbsp;&nbsp;â€¢ ${deviceName}: ${action}<br>`;
                
                // è®¾å¤‡é—´å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            resultHtml += `<strong>æ‰§è¡Œæ—¶é—´:</strong> ${new Date().toLocaleTimeString()}</div>`;
            document.getElementById('sceneResult').innerHTML = resultHtml;

            updateDeviceDisplay();
        }

        // è·å–è®¾å¤‡åç§°
        function getDeviceName(id) {
            const names = {
                1: 'å®¢å…ç¯',
                2: 'å§å®¤ä¸»ç¯',
                3: 'å§å®¤æ°›å›´ç¯',
                4: 'ç©ºè°ƒ',
                7: 'éŸ³å“'
            };
            return names[id] || 'æœªçŸ¥è®¾å¤‡';
        }

        // è·å–è®¾å¤‡ä¿¡å·
        function getDeviceSignal(id, active) {
            const signals = {
                1: active ? '1' : '5',  // å®¢å…ç¯
                2: active ? '6' : '8',  // å§å®¤ä¸»ç¯
                3: active ? '7' : 'd',  // å§å®¤æ°›å›´ç¯
                4: active ? '9' : 'a',  // ç©ºè°ƒ
                7: active ? 'b' : 'c'   // éŸ³å“
            };
            return signals[id] || '0';
        }

        // åˆ‡æ¢è¯­éŸ³è¯†åˆ«çŠ¶æ€
        function toggleVoiceRecognition() {
            const ball = document.getElementById('floatingBall');
            isListening = !isListening;
            
            if (isListening) {
                ball.classList.add('listening');
                ball.textContent = 'ğŸ”´';
                setTimeout(() => {
                    testVoiceRecognition();
                    ball.classList.remove('listening');
                    ball.textContent = 'ğŸ¤';
                    isListening = false;
                }, 2000);
            }
        }

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateDeviceDisplay();
    </script>
</body>
</html>
