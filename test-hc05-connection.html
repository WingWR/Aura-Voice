<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HC-05 è“ç‰™æ¨¡å—è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 40px;
            opacity: 0.8;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section h3 {
            margin-top: 0;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }
        
        .status-dot.success {
            background: #28a745;
        }
        
        .status-dot.warning {
            background: #ffc107;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn.success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-entry.info {
            color: #17a2b8;
        }
        
        .log-entry.success {
            color: #28a745;
        }
        
        .log-entry.error {
            color: #dc3545;
        }
        
        .log-entry.warning {
            color: #ffc107;
        }
        
        .instructions {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .instructions h4 {
            color: #ffc107;
            margin-top: 0;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .command-test {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        
        .command-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px 12px;
            color: white;
            font-family: 'Courier New', monospace;
        }
        
        .command-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ”µ HC-05 è“ç‰™æ¨¡å—æµ‹è¯•</h1>
        <p class="subtitle">ä¸“é—¨ç”¨äºæµ‹è¯•HC-05è“ç‰™æ¨¡å—çš„è¿æ¥å’Œé€šä¿¡</p>
        
        <div class="instructions">
            <h4>ğŸ“‹ è¿æ¥æ­¥éª¤</h4>
            <ol>
                <li><strong>é…å¯¹HC-05ï¼š</strong> åœ¨Windowsè“ç‰™è®¾ç½®ä¸­æœç´¢å¹¶é…å¯¹HC-05è®¾å¤‡ï¼ˆé»˜è®¤PIN: 1234æˆ–0000ï¼‰</li>
                <li><strong>ç¡®è®¤COMå£ï¼š</strong> åœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­æŸ¥çœ‹HC-05åˆ†é…çš„COMç«¯å£å·</li>
                <li><strong>ä½¿ç”¨Chromeï¼š</strong> ç¡®ä¿ä½¿ç”¨Chrome 89+æˆ–Edge 89+æµè§ˆå™¨</li>
                <li><strong>ç‚¹å‡»è¿æ¥ï¼š</strong> ç‚¹å‡»ä¸‹æ–¹"è¿æ¥HC-05"æŒ‰é’®ï¼Œé€‰æ‹©å¯¹åº”çš„ä¸²å£</li>
                <li><strong>æµ‹è¯•é€šä¿¡ï¼š</strong> å‘é€æµ‹è¯•æŒ‡ä»¤éªŒè¯è¿æ¥</li>
            </ol>
        </div>
        
        <div class="section">
            <h3>ğŸ” ç³»ç»Ÿæ£€æµ‹</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-dot" :class="{ success: hasSerial }"></div>
                    <span>Web Serial API: {{ hasSerial ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ' }}</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" :class="{ success: hasBluetooth }"></div>
                    <span>Web Bluetooth API: {{ hasBluetooth ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ' }}</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" :class="{ success: isConnected, warning: isConnecting }"></div>
                    <span>è¿æ¥çŠ¶æ€: {{ connectionStatus }}</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" :class="{ success: connectionType !== 'none' }"></div>
                    <span>è¿æ¥æ–¹å¼: {{ connectionTypeText }}</span>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ”§ è¿æ¥æ§åˆ¶</h3>
            <div class="button-group">
                <button class="btn" :class="{ success: isConnected }" @click="connectDevice" :disabled="isConnecting">
                    {{ isConnecting ? 'è¿æ¥ä¸­...' : (isConnected ? 'å·²è¿æ¥' : 'è¿æ¥HC-05') }}
                </button>
                <button class="btn danger" @click="disconnectDevice" :disabled="!isConnected">
                    æ–­å¼€è¿æ¥
                </button>
                <button class="btn" @click="getConnectionInfo">
                    è·å–è¿æ¥ä¿¡æ¯
                </button>
                <button class="btn" @click="clearLog">
                    æ¸…ç©ºæ—¥å¿—
                </button>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“¡ æŒ‡ä»¤æµ‹è¯•</h3>
            <div class="button-group">
                <button class="btn" @click="sendTestCommand('1')" :disabled="!isConnected">æµ‹è¯•æŒ‡ä»¤: 1</button>
                <button class="btn" @click="sendTestCommand('2')" :disabled="!isConnected">æµ‹è¯•æŒ‡ä»¤: 2</button>
                <button class="btn" @click="sendTestCommand('3')" :disabled="!isConnected">æµ‹è¯•æŒ‡ä»¤: 3</button>
                <button class="btn" @click="sendTestCommand('AT')" :disabled="!isConnected">ATæŒ‡ä»¤æµ‹è¯•</button>
            </div>
            
            <div class="command-test">
                <input 
                    type="text" 
                    class="command-input" 
                    v-model="customCommand" 
                    placeholder="è¾“å…¥è‡ªå®šä¹‰æŒ‡ä»¤..."
                    @keyup.enter="sendCustomCommand"
                >
                <button class="btn" @click="sendCustomCommand" :disabled="!isConnected || !customCommand">
                    å‘é€
                </button>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“ æ“ä½œæ—¥å¿—</h3>
            <div class="log-container" ref="logContainer">
                <div v-for="(log, index) in logs" :key="index" class="log-entry" :class="log.type">
                    [{{ log.time }}] {{ log.message }}
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, computed, nextTick, onMounted } = Vue;
        
        createApp({
            setup() {
                const logs = ref([]);
                const logContainer = ref(null);
                const isConnecting = ref(false);
                const customCommand = ref('');
                
                // æ¨¡æ‹Ÿè“ç‰™æ§åˆ¶å¯¹è±¡
                const bluetoothControl = {
                    isConnected: ref(false),
                    connectionType: ref('none'),
                    serialPort: ref(null),
                    
                    async connectBluetooth() {
                        if (!navigator.serial) {
                            throw new Error('æµè§ˆå™¨ä¸æ”¯æŒWeb Serial API');
                        }
                        
                        const port = await navigator.serial.requestPort();
                        await port.open({
                            baudRate: 9600,
                            dataBits: 8,
                            stopBits: 1,
                            parity: 'none'
                        });
                        
                        this.serialPort.value = port;
                        this.isConnected.value = true;
                        this.connectionType.value = 'serial';
                        return true;
                    },
                    
                    async disconnectBluetooth() {
                        if (this.serialPort.value) {
                            await this.serialPort.value.close();
                            this.serialPort.value = null;
                        }
                        this.isConnected.value = false;
                        this.connectionType.value = 'none';
                    },
                    
                    async sendCommand(command) {
                        if (!this.isConnected.value || !this.serialPort.value) {
                            throw new Error('è®¾å¤‡æœªè¿æ¥');
                        }
                        
                        const writer = this.serialPort.value.writable.getWriter();
                        const encoder = new TextEncoder();
                        const data = encoder.encode(command + '\n');
                        
                        await writer.write(data);
                        writer.releaseLock();
                        return true;
                    },
                    
                    getConnectionInfo() {
                        return {
                            isConnected: this.isConnected.value,
                            connectionType: this.connectionType.value,
                            hasSerial: !!navigator.serial,
                            hasBluetooth: !!navigator.bluetooth
                        };
                    }
                };
                
                const hasSerial = computed(() => !!navigator.serial);
                const hasBluetooth = computed(() => !!navigator.bluetooth);
                const isConnected = computed(() => bluetoothControl.isConnected.value);
                const connectionType = computed(() => bluetoothControl.connectionType.value);
                
                const connectionStatus = computed(() => {
                    if (isConnecting.value) return 'è¿æ¥ä¸­...';
                    if (isConnected.value) return 'å·²è¿æ¥';
                    return 'æœªè¿æ¥';
                });
                
                const connectionTypeText = computed(() => {
                    switch (connectionType.value) {
                        case 'serial': return 'ä¸²å£è¿æ¥';
                        case 'web-bluetooth': return 'è“ç‰™è¿æ¥';
                        default: return 'æ— è¿æ¥';
                    }
                });
                
                const addLog = (message, type = 'info') => {
                    const time = new Date().toLocaleTimeString();
                    logs.value.push({ time, message, type });
                    nextTick(() => {
                        if (logContainer.value) {
                            logContainer.value.scrollTop = logContainer.value.scrollHeight;
                        }
                    });
                };
                
                const connectDevice = async () => {
                    if (isConnecting.value || isConnected.value) return;
                    
                    isConnecting.value = true;
                    addLog('å¼€å§‹è¿æ¥HC-05è“ç‰™æ¨¡å—...', 'info');
                    
                    try {
                        await bluetoothControl.connectBluetooth();
                        addLog('âœ… HC-05è¿æ¥æˆåŠŸï¼', 'success');
                        addLog('è¿æ¥æ–¹å¼: ä¸²å£é€šä¿¡', 'info');
                    } catch (error) {
                        addLog('âŒ è¿æ¥å¤±è´¥: ' + error.message, 'error');
                        if (error.message.includes('No port selected')) {
                            addLog('ğŸ’¡ æç¤º: è¯·åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰æ‹©HC-05å¯¹åº”çš„COMç«¯å£', 'warning');
                        }
                    } finally {
                        isConnecting.value = false;
                    }
                };
                
                const disconnectDevice = async () => {
                    try {
                        await bluetoothControl.disconnectBluetooth();
                        addLog('ğŸ”Œ è®¾å¤‡å·²æ–­å¼€è¿æ¥', 'info');
                    } catch (error) {
                        addLog('âŒ æ–­å¼€è¿æ¥å¤±è´¥: ' + error.message, 'error');
                    }
                };
                
                const sendTestCommand = async (command) => {
                    try {
                        addLog(`ğŸ“¤ å‘é€æµ‹è¯•æŒ‡ä»¤: ${command}`, 'info');
                        await bluetoothControl.sendCommand(command);
                        addLog(`âœ… æŒ‡ä»¤å‘é€æˆåŠŸ: ${command}`, 'success');
                    } catch (error) {
                        addLog(`âŒ æŒ‡ä»¤å‘é€å¤±è´¥: ${error.message}`, 'error');
                    }
                };
                
                const sendCustomCommand = async () => {
                    if (!customCommand.value.trim()) return;
                    
                    try {
                        const cmd = customCommand.value.trim();
                        addLog(`ğŸ“¤ å‘é€è‡ªå®šä¹‰æŒ‡ä»¤: ${cmd}`, 'info');
                        await bluetoothControl.sendCommand(cmd);
                        addLog(`âœ… æŒ‡ä»¤å‘é€æˆåŠŸ: ${cmd}`, 'success');
                        customCommand.value = '';
                    } catch (error) {
                        addLog(`âŒ æŒ‡ä»¤å‘é€å¤±è´¥: ${error.message}`, 'error');
                    }
                };
                
                const getConnectionInfo = () => {
                    const info = bluetoothControl.getConnectionInfo();
                    addLog('ğŸ“Š è¿æ¥ä¿¡æ¯:', 'info');
                    addLog(`  - è¿æ¥çŠ¶æ€: ${info.isConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}`, 'info');
                    addLog(`  - è¿æ¥æ–¹å¼: ${info.connectionType}`, 'info');
                    addLog(`  - Web Serialæ”¯æŒ: ${info.hasSerial ? 'æ˜¯' : 'å¦'}`, 'info');
                    addLog(`  - Web Bluetoothæ”¯æŒ: ${info.hasBluetooth ? 'æ˜¯' : 'å¦'}`, 'info');
                };
                
                const clearLog = () => {
                    logs.value = [];
                };
                
                onMounted(() => {
                    addLog('ğŸš€ HC-05æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
                    addLog('ğŸ’¡ è¯·ç¡®ä¿HC-05å·²åœ¨Windowsä¸­é…å¯¹æˆåŠŸ', 'warning');
                    getConnectionInfo();
                });
                
                return {
                    logs,
                    logContainer,
                    isConnecting,
                    customCommand,
                    hasSerial,
                    hasBluetooth,
                    isConnected,
                    connectionType,
                    connectionStatus,
                    connectionTypeText,
                    connectDevice,
                    disconnectDevice,
                    sendTestCommand,
                    sendCustomCommand,
                    getConnectionInfo,
                    clearLog
                };
            }
        }).mount('body');
    </script>
</body>
</html>
